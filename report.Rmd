---
title: "iGAS Exceedance"
author: "Massimo Cavallaro"
date: "19 August 2020"
output: word_document
---

## Description of the dataset.

The dataset consists of 1780 records of dated GAS samples collected from 2014-12-28 to 2020-12-14 from patients in the Midlands (1433 unique postcodes of which 52 mispelled or `NA`) with genotyping results.

A number of 156 different EMM types were detected. The frequencies of the most common EMM types are reported in the table below.

 `1.0` |`89.0`|`12.0` |`28.0` |`66.0` | `4.0`| `94.0`|NA| `87.0`| `3.93` |
-----|-----|-----|-----|-----|---|---|---|---|---|---|
 368 | 185  |127   |94|   88|   79  | 75|   72  | 48|   47| 

Few dates appear to be mistakenly recorded or randomised  -- these are too far in the future or in the past or present inconsistencies between collection and lab-test dates -- this will be ignored in the preliminary results.



## Description of the method.

In a pre-processing stage, samples obtained from non-sterile sites were filtered out, postcodes were mapped to geographical coordinates, and records were aggregated by sample collection week. The latter implies that the signature of an outbreak can be detected with one/two weeks of delay from the genotyping result day.

For each emm type, postcode, and week date, a reference baseline is estimated using three modelling approaches  (which we refer to as *sum*, *cMLE*, and *LOESS*, respectively) that incorporate the seasonal and the geografical trends, whilst tolerating data  sparsity.



![](time_factor.png)

The aggregated temporal trend displays moderated seasonality and average increase in case frequency during the most recent years (despite  data from 2020 are incomplete).


```{r eval=FALSE, include=FALSE}
library(sf)
library(spatstat)
  
png('spatial_baseline_full.png', width = 3.25, height = 3.25, units = 'in', res=500, pointsize = 4)
par(mar=c(2,2,4,2))
A=st_read("shape_file_new/Areas.shp")
crs = st_crs(A)
#B=st_read("England_AL4-AL4.shp")
B = st_read("shape_files/RegionBoundaries.shp")
B = st_transform(B, crs=crs)
smoothScatter(dat$longitude, dat$latitude,  ylim= c(49,60),
              xlabel='longitude', 
              ylabel='latitude', main='Spatial baseline up to 2020-12-14')
plot(st_geometry(A),  col=NA, border='#e2e2e288', lwd=0.8,  add=T)
plot(st_geometry(B),  col=NA, border='black', lwd=0.8,  add=T)

dev.off()
```

![](spatial_baseline.png)



The algorithm scans the dataset using spatio-temporal portions (cylinders) of arbitary size and position (drawn using a Monte Carlo strategy) and compares the number of observed cases in each portion to a baseline prediction, thus raising a warning if there are spatially close cases not explained by the temporal and the spatial average trends.


The method depends on a number of parameters which model the baseline predictions and the random-scan subroutine. These still need to be calibrated, therefore the software is *not* ready for usage and dissemination. The code is not optimised for speed as yet (as it takes approximately half an hour to scan 50 weeks), however strategies to improve the speed of execution have been identified.

An improvement of the estimates can ideally be obtained by incorporating information on the number of resident per full postcode (which should to be available from the 2011 census in England -- so far, I've only been able to retrieve postcode-sector census data).

Running the algorithm over the most common emm-type subset (i.e., `1.0`), yields the exceedance plots below,
where the dots correspond to the postcodes of the patients tested during the time interval in the figure title -- exceeding cases are flagged in red color. Blu ellipses are the projections of some of the cyclinders used to scan the data set. Inspecting the plots suggests to use cylinders with smaller radia and lower thresholds.

Also, for more reliable results, it is important to know what is the exact area of interest in terms of postcode area and districts (e.g., the algorithm flags isolated cases outside the Midlands where there is insufficient data to predict a good baseline).

![](Exceedances2018-02-08_to_2018-11-15.png)


![](Exceedances2018-06-28_to_2019-04-04.png)













![](Exceedances2018-11-15_to_2019-08-22.png)



![](Exceedances2019-04-04_to_2020-01-09.png)


